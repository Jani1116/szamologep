<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Toolbox Pro - Math</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        :root {
            --bg: #000000; --card: #1c1c1e; --accent: #0a84ff; --text: #ffffff; 
            --gray: #8e8e93; --border: #38383a; --red: #ff453a; --success: #30d158;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; background: var(--card); border-radius: 30px; padding: 25px; min-height: 90vh; display: flex; flex-direction: column; border: 1px solid var(--border); box-sizing: border-box; }
        h2 { text-align: center; margin-bottom: 20px; }
        input { background: #2c2c2e; border: 1px solid var(--border); color: white; padding: 18px; border-radius: 12px; width: 100%; font-size: 20px; box-sizing: border-box; outline: none; font-family: 'Courier New', monospace; }
        .btn-3d { background: var(--accent); border: none; border-radius: 15px; color: white; font-size: 20px; font-weight: bold; padding: 15px 0; cursor: pointer; box-shadow: 0 6px #0056b3; margin-top: 15px; width: 100%; transition: 0.1s; }
        .btn-3d:active { box-shadow: 0 2px #0056b3; transform: translateY(4px); }
        .result-box { background: rgba(48, 209, 88, 0.1); padding: 20px; border-radius: 14px; border: 1px solid var(--success); margin: 20px 0; font-weight: 600; font-size: 22px; text-align: center; }
        .steps { background: #111; padding: 15px; border-radius: 10px; font-size: 14px; color: var(--gray); line-height: 1.5; overflow-x: auto; }
        .back-btn { background: #333; color: white; border: 1px solid var(--border); padding: 15px; border-radius: 16px; width: 100%; margin-top: auto; }
        small { color: var(--gray); display: block; text-align: center; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Egyenletmegoldó</h2>
    <small>Példák: 2x^2 - 4x + 2 = 0 | x/2 + 5 = 10 | sqrt(x) = 4</small>
    
    <input type="text" id="eq-input" placeholder="Írd be az egyenletet..." inputmode="text">
    
    <button class="btn-3d" onclick="solve()">Megoldás</button>

    <div id="res-area" class="hidden">
        <div class="result-box" id="eq-res">x = ?</div>
        <div class="steps" id="eq-steps"></div>
    </div>

    <button class="back-btn" onclick="window.history.back()">Vissza</button>
</div>

<script>
function solve() {
    const input = document.getElementById('eq-input').value.replace(':', '/');
    const resBox = document.getElementById('eq-res');
    const stepsBox = document.getElementById('eq-steps');
    const resArea = document.getElementById('res-area');

    if (!input.includes('=')) {
        resBox.innerText = "Hiba: Hiányzik az '=' jel!";
        return;
    }

    try {
        const parts = input.split('=');
        // Átrendezzük 0-ra: (bal oldal) - (jobb oldal) = 0
        const equation = `(${parts[0]}) - (${parts[1]})`;
        
        // Megoldás keresése (numerikus közelítéssel komplexebb esetekre)
        // Először megpróbáljuk egyszerű szimbolikus megoldással (ha másodfokú)
        let results = [];
        
        if (input.includes('^2')) {
            // Másodfokú felismerő és megoldó
            results = solveQuadratic(parts[0], parts[1]);
        } else {
            // Lineáris vagy törtes
            const x = math.evaluate(`solve(${equation} = 0, x)`); 
            // Megjegyzés: a math.js solve funkciója egyes verziókban máshogy érhető el, 
            // ezért egy biztosabb Newton-módszer alapú keresőt használunk:
            const f = math.parse(equation).compile();
            const root = findRoot(f);
            results = [root];
        }

        resBox.innerHTML = results.map((r, i) => `x<sub>${i+1}</sub> = ${math.format(r, {precision: 4})}`).join('<br>');
        stepsBox.innerHTML = `<b>Elemzett egyenlet:</b> ${equation} = 0<br><b>Módszer:</b> ${input.includes('^2') ? 'Másodfokú megoldóképlet' : 'Algebrái átalakítás'}`;
        resArea.classList.remove('hidden');

    } catch (e) {
        resBox.innerText = "Hiba: Ellenőrizd a formátumot!";
        stepsBox.innerText = e.message;
    }
}

function solveQuadratic(left, right) {
    // Kifejezés normalizálása: ax^2 + bx + c
    const expr = math.simplify(`(${left}) - (${right})`).toString();
    // Együtthatók kinyerése (leegyszerűsített parser)
    const node = math.parse(expr);
    let coeffs = { a: 0, b: 0, c: 0 };
    
    // Alapvető együttható kereső
    math.parse(expr).traverse(function (node) {
        if (node.isSymbolNode && node.name === 'x') { /* x keresése */ }
    });

    // Biztonsági manuális megoldás a math.js segítségével
    // f(0), f(1), f(-1) értékekből kiszámoljuk a, b, c-t
    const f = math.parse(expr).compile();
    const c = f.evaluate({x: 0});
    const fp1 = f.evaluate({x: 1});
    const fm1 = f.evaluate({x: -1});
    const a = (fp1 + fm1 - 2*c) / 2;
    const b = fp1 - a - c;

    const d = b*b - 4*a*c;
    if (d < 0) return ["Nincs valós gyök"];
    if (d === 0) return [-b / (2*a)];
    return [(-b + Math.sqrt(d)) / (2*a), (-b - Math.sqrt(d)) / (2*a)];
}

function findRoot(f) {
    // Newton-Raphson közelítés egyszerű egyenletekhez
    let x = 1;
    for (let i = 0; i < 20; i++) {
        const val = f.evaluate({x: x});
        const eps = 0.0001;
        const der = (f.evaluate({x: x + eps}) - val) / eps;
        if (Math.abs(der) < eps) break;
        x = x - val / der;
    }
    return x;
}
</script>

</body>
</html>
